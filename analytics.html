<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Analytics | Da4lions Pay-tec</title>
    <meta name="robots" content="noindex,nofollow" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/lion-logo-32.png?v=2" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/lion-logo-16.png?v=2" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/lion-logo-180.png?v=2" />
    <link rel="stylesheet" href="/assets/style.css" />
  </head>
  <body data-page="analytics">
    <header class="topbar">
      <div class="brand brand-mark"><img src="/assets/da4lions-logo.jpeg" alt="Da4lions Pay-tec logo" class="brand-logo" /><span class="brand-copy">Da4lions Pay-tec Analytics</span></div>
      <button id="menuButton" class="menu-btn" aria-label="Toggle navigation">&#9776;</button>
      <nav id="mainNav" class="nav-links">
        <a href="/"><img class="nav-link__icon" src="/assets/icons8-home-48.png" alt="" aria-hidden="true" />Home</a>
        <a href="/notifications.html"><img class="nav-link__icon" src="/assets/icons8-notification-48.png" alt="" aria-hidden="true" />Notifications</a>
        <a href="/handouts.html"><img class="nav-link__icon" src="/assets/icons8-books-50.png" alt="" aria-hidden="true" />Handouts</a>
        <a href="/payments.html"><img class="nav-link__icon" src="/assets/icons8-cash-and-credit-card-50.png" alt="" aria-hidden="true" />Payments</a>
        <a href="/lecturer"><img class="nav-link__icon" src="/assets/icons8-lecturer-50.png" alt="" aria-hidden="true" />Lecturer</a>
        <a class="active" href="/analytics"><img class="nav-link__icon" src="/assets/icons8-cash-and-credit-card-50.png" alt="" aria-hidden="true" />Analytics</a>
        <button id="profileToggleButton" class="profile-trigger" type="button"><img class="nav-link__icon" src="/assets/icons8-profile-24.png" alt="" aria-hidden="true" />Profile</button>
        <form method="post" action="/logout" class="logout-form">
          <input type="hidden" name="_csrf" value="" />
          <button type="submit" class="logout-btn">Log out</button>
        </form>
      </nav>
    </header>

    <main class="container analytics-layout">
      <section class="page-title">
        <h1>Advanced Analytics and Visual Dashboards</h1>
        <p>Track collections, reconciliation flow, and Paystack outcomes with role-scoped insights.</p>
      </section>

      <section class="card analytics-controls">
        <h2>Filters</h2>
        <p id="analyticsStatus" class="auth-subtitle">Choose filters and refresh to load analytics.</p>
        <form id="analyticsFiltersForm" class="auth-form">
          <div class="filter-grid analytics-filter-grid">
            <label>
              From
              <input id="analyticsFrom" type="date" required />
            </label>
            <label>
              To
              <input id="analyticsTo" type="date" required />
            </label>
            <label>
              Granularity
              <select id="analyticsGranularity">
                <option value="day">Day</option>
                <option value="week">Week</option>
                <option value="month">Month</option>
              </select>
            </label>
            <label>
              Payment Item (Optional)
              <select id="analyticsPaymentItem">
                <option value="">All payment items</option>
              </select>
            </label>
            <div class="filter-actions analytics-filter-actions">
              <button id="analyticsRefreshButton" type="submit" class="btn btn-secondary">Refresh</button>
              <button id="analyticsExportButton" type="button" class="btn">Export CSV</button>
            </div>
          </div>
        </form>
      </section>

      <section class="grid analytics-kpis">
        <article class="card kpi-card analytics-dynamic">
          <h3>Total Collected</h3>
          <p id="kpiTotalCollected" class="kpi-value">-</p>
        </article>
        <article class="card kpi-card analytics-dynamic">
          <h3>Outstanding Amount</h3>
          <p id="kpiOutstandingAmount" class="kpi-value">-</p>
        </article>
        <article class="card kpi-card analytics-dynamic">
          <h3>Collection Rate</h3>
          <p id="kpiCollectionRate" class="kpi-value">-</p>
        </article>
        <article class="card kpi-card analytics-dynamic">
          <h3>Open Exceptions</h3>
          <p id="kpiOpenExceptions" class="kpi-value">-</p>
        </article>
        <article class="card kpi-card analytics-dynamic">
          <h3>Auto-Approval Rate</h3>
          <p id="kpiAutoApprovalRate" class="kpi-value">-</p>
        </article>
        <article class="card kpi-card analytics-dynamic">
          <h3>Receipt Generation Success</h3>
          <p id="kpiReceiptSuccessRate" class="kpi-value">-</p>
        </article>
      </section>

      <section class="analytics-chart-grid">
        <article class="card chart-card analytics-dynamic">
          <h3>Revenue Trend</h3>
          <div class="chart-canvas-wrap">
            <canvas id="revenueChart" height="220"></canvas>
          </div>
          <div id="revenueFallback" class="analytics-fallback" hidden></div>
        </article>

        <article class="card chart-card analytics-dynamic">
          <h3>Transaction Status Breakdown</h3>
          <div class="chart-canvas-wrap">
            <canvas id="statusBreakdownChart" height="220"></canvas>
          </div>
          <div id="statusBreakdownFallback" class="analytics-fallback" hidden></div>
        </article>

        <article class="card chart-card analytics-dynamic">
          <h3>Reconciliation Funnel</h3>
          <div class="chart-canvas-wrap">
            <canvas id="reconciliationFunnelChart" height="220"></canvas>
          </div>
          <div id="reconciliationFunnelFallback" class="analytics-fallback" hidden></div>
        </article>

        <article class="card chart-card analytics-dynamic">
          <h3>Top Payment Items by Collections</h3>
          <div class="chart-canvas-wrap">
            <canvas id="topItemsChart" height="220"></canvas>
          </div>
          <div id="topItemsFallback" class="analytics-fallback" hidden></div>
        </article>

        <article class="card chart-card analytics-dynamic">
          <h3>Outstanding Aging Buckets</h3>
          <div class="chart-canvas-wrap">
            <canvas id="agingChart" height="220"></canvas>
          </div>
          <div id="agingFallback" class="analytics-fallback" hidden></div>
        </article>

        <article class="card chart-card analytics-dynamic">
          <h3>Paystack Session Funnel</h3>
          <div class="chart-canvas-wrap">
            <canvas id="paystackFunnelChart" height="220"></canvas>
          </div>
          <div id="paystackFunnelFallback" class="analytics-fallback" hidden></div>
        </article>
      </section>
    </main>

    <script src="/assets/csrf.js"></script>
    <script src="/assets/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
    <script src="/assets/analytics.js"></script>
    <script src="/assets/profile.js"></script>
  </body>
</html>
